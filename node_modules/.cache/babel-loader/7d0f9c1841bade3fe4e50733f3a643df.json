{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.symbol.js\");\nrequire(\"core-js/modules/es.symbol.description.js\");\nrequire(\"core-js/modules/es.symbol.iterator.js\");\nrequire(\"core-js/modules/es.array.iterator.js\");\nrequire(\"core-js/modules/es.string.iterator.js\");\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\nrequire(\"core-js/modules/es.array.slice.js\");\nrequire(\"core-js/modules/es.array.from.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.ValidationChecker = void 0;\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.regexp.exec.js\");\nrequire(\"core-js/modules/es.string.split.js\");\nrequire(\"core-js/modules/es.array.concat.js\");\nrequire(\"core-js/modules/es.regexp.constructor.js\");\nrequire(\"core-js/modules/es.regexp.to-string.js\");\nrequire(\"core-js/modules/es.array.filter.js\");\nrequire(\"core-js/modules/es.array.includes.js\");\nrequire(\"core-js/modules/es.string.includes.js\");\nrequire(\"core-js/modules/es.array.map.js\");\nrequire(\"core-js/modules/es.number.constructor.js\");\nrequire(\"core-js/modules/es.object.keys.js\");\nrequire(\"core-js/modules/es.string.trim.js\");\nrequire(\"core-js/modules/es.string.match.js\");\nrequire(\"core-js/modules/es.string.replace.js\");\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\nrequire(\"core-js/modules/es.object.values.js\");\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\nvar _utils = require(\"../utils/utils\");\nvar _moment = _interopRequireDefault(require(\"moment\"));\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\nvar _fetchPonyfill2 = _interopRequireDefault(require(\"fetch-ponyfill\"));\nvar _calendarUtils = require(\"../utils/calendarUtils\");\nvar _Rules = _interopRequireDefault(require(\"./Rules\"));\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n  return arr2;\n}\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _s, _e;\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n  return _arr;\n}\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nvar _fetchPonyfill = (0, _fetchPonyfill2.default)({\n    Promise: _nativePromiseOnly.default\n  }),\n  fetch = _fetchPonyfill.fetch,\n  Headers = _fetchPonyfill.Headers,\n  Request = _fetchPonyfill.Request;\nvar ValidationChecker = /*#__PURE__*/function () {\n  function ValidationChecker() {\n    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, ValidationChecker);\n    this.config = _lodash.default.defaults(config, ValidationChecker.config);\n    this.validators = {\n      required: {\n        key: 'validate.required',\n        method: 'validateRequired',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('required'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          if (!(0, _utils.boolValue)(setting) || component.isValueHidden()) {\n            return true;\n          }\n          var isCalendar = component.validators.some(function (validator) {\n            return validator === 'calendar';\n          });\n          if (!value && isCalendar && component.widget.enteredDate) {\n            return !this.validators.calendar.check.call(this, component, setting, value);\n          }\n          return !component.isEmpty(value);\n        }\n      },\n      onlyAvailableItems: {\n        key: 'validate.onlyAvailableItems',\n        method: 'validateValueAvailability',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('valueIsNotAvailable'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting) {\n          return !(0, _utils.boolValue)(setting);\n        }\n      },\n      unique: {\n        key: 'validate.unique',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('unique'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var _this = this;\n\n          // Skip if setting is falsy\n          if (!(0, _utils.boolValue)(setting)) {\n            return true;\n          } // Skip if value is empty object or falsy\n\n          if (!value || _lodash.default.isObjectLike(value) && _lodash.default.isEmpty(value)) {\n            return true;\n          } // Skip if we don't have a database connection\n\n          if (!this.config.db) {\n            return true;\n          }\n          return new _nativePromiseOnly.default(function (resolve) {\n            var form = _this.config.form;\n            var submission = _this.config.submission;\n            var path = \"data.\".concat(component.path);\n            var addPathQueryParams = function addPathQueryParams(pathQueryParams, query, path) {\n              var pathArray = path.split(/\\[\\d+\\]?./);\n              var needValuesInArray = pathArray.length > 1;\n              var pathToValue = path;\n              if (needValuesInArray) {\n                pathToValue = pathArray.shift();\n                var pathQueryObj = {};\n                _lodash.default.reduce(pathArray, function (pathQueryPath, pathPart, index) {\n                  var isLastPathPart = index === pathArray.length - 1;\n                  var obj = _lodash.default.get(pathQueryObj, pathQueryPath, pathQueryObj);\n                  var addedPath = \"$elemMatch['\".concat(pathPart, \"']\");\n                  _lodash.default.set(obj, addedPath, isLastPathPart ? pathQueryParams : {});\n                  return pathQueryPath ? \"\".concat(pathQueryPath, \".\").concat(addedPath) : addedPath;\n                }, '');\n                query[pathToValue] = pathQueryObj;\n              } else {\n                query[pathToValue] = pathQueryParams;\n              }\n            }; // Build the query\n\n            var query = {\n              form: form._id\n            };\n            if (_lodash.default.isString(value)) {\n              if (component.component.dbIndex) {\n                addPathQueryParams(value, query, path);\n              } else {\n                addPathQueryParams({\n                  $regex: new RegExp(\"^\".concat((0, _utils.escapeRegExCharacters)(value), \"$\")),\n                  $options: 'i'\n                }, query, path);\n              }\n            } // FOR-213 - Pluck the unique location id\n            else if (_lodash.default.isPlainObject(value) && value.address && value.address['address_components'] && value.address['place_id']) {\n              addPathQueryParams({\n                $regex: new RegExp(\"^\".concat((0, _utils.escapeRegExCharacters)(value.address['place_id']), \"$\")),\n                $options: 'i'\n              }, query, \"\".concat(path, \".address.place_id\"));\n            } // Compare the contents of arrays vs the order.\n            else if (_lodash.default.isArray(value)) {\n              addPathQueryParams({\n                $all: value\n              }, query, path);\n            } else if (_lodash.default.isObject(value) || _lodash.default.isNumber(value)) {\n              addPathQueryParams({\n                $eq: value\n              }, query, path);\n            } // Only search for non-deleted items\n\n            query.deleted = {\n              $eq: null\n            }; // Try to find an existing value within the form\n\n            _this.config.db.findOne(query, function (err, result) {\n              if (err) {\n                return resolve(false);\n              } else if (result) {\n                // Only OK if it matches the current submission\n                if (submission._id && result._id.toString() === submission._id) {\n                  resolve(true);\n                } else {\n                  component.conflictId = result._id.toString();\n                  return resolve(false);\n                }\n              } else {\n                return resolve(true);\n              }\n            });\n          }).catch(function () {\n            return false;\n          });\n        }\n      },\n      multiple: {\n        key: 'validate.multiple',\n        hasLabel: true,\n        message: function message(component) {\n          var shouldBeArray = (0, _utils.boolValue)(component.component.multiple) || Array.isArray(component.emptyValue);\n          var isRequired = component.component.validate.required;\n          var messageKey = shouldBeArray ? isRequired ? 'array_nonempty' : 'array' : 'nonarray';\n          return component.t(component.errorMessage(messageKey), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          // Skip multiple validation if the component tells us to\n          if (!component.validateMultiple()) {\n            return true;\n          }\n          var shouldBeArray = (0, _utils.boolValue)(setting);\n          var canBeArray = Array.isArray(component.emptyValue);\n          var isArray = Array.isArray(value);\n          var isRequired = component.component.validate.required;\n          if (shouldBeArray) {\n            if (isArray) {\n              return isRequired ? !!value.length : true;\n            } else {\n              // Null/undefined is ok if this value isn't required; anything else should fail\n              return _lodash.default.isNil(value) ? !isRequired : false;\n            }\n          } else {\n            return canBeArray || !isArray;\n          }\n        }\n      },\n      select: {\n        key: 'validate.select',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('select'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value, data, index, row, async) {\n          // Skip if setting is falsy\n          if (!(0, _utils.boolValue)(setting)) {\n            return true;\n          } // Skip if value is empty\n\n          if (!value || _lodash.default.isEmpty(value)) {\n            return true;\n          } // Skip if we're not async-capable\n\n          if (!async) {\n            return true;\n          }\n          var schema = component.component; // Initialize the request options\n\n          var requestOptions = {\n            url: setting,\n            method: 'GET',\n            qs: {},\n            json: true,\n            headers: {}\n          }; // If the url is a boolean value\n\n          if (_lodash.default.isBoolean(requestOptions.url)) {\n            requestOptions.url = !!requestOptions.url;\n            if (!requestOptions.url || schema.dataSrc !== 'url' || !schema.data.url || !schema.searchField) {\n              return true;\n            } // Get the validation url\n\n            requestOptions.url = schema.data.url; // Add the search field\n\n            requestOptions.qs[schema.searchField] = value; // Add the filters\n\n            if (schema.filter) {\n              requestOptions.url += (!requestOptions.url.includes('?') ? '?' : '&') + schema.filter;\n            } // If they only wish to return certain fields.\n\n            if (schema.selectFields) {\n              requestOptions.qs.select = schema.selectFields;\n            }\n          }\n          if (!requestOptions.url) {\n            return true;\n          } // Make sure to interpolate.\n\n          requestOptions.url = (0, _utils.interpolate)(requestOptions.url, {\n            data: component.data\n          }); // Add query string to URL\n\n          requestOptions.url += (requestOptions.url.includes('?') ? '&' : '?') + _lodash.default.chain(requestOptions.qs).map(function (val, key) {\n            return \"\".concat(encodeURIComponent(key), \"=\").concat(encodeURIComponent(val));\n          }).join('&').value(); // Set custom headers.\n\n          if (schema.data && schema.data.headers) {\n            _lodash.default.each(schema.data.headers, function (header) {\n              if (header.key) {\n                requestOptions.headers[header.key] = header.value;\n              }\n            });\n          } // Set form.io authentication.\n\n          if (schema.authenticate && this.config.token) {\n            requestOptions.headers['x-jwt-token'] = this.config.token;\n          }\n          return fetch(new Request(requestOptions.url, {\n            headers: new Headers(requestOptions.headers)\n          })).then(function (response) {\n            if (!response.ok) {\n              return false;\n            }\n            return response.json();\n          }).then(function (results) {\n            return results && results.length;\n          }).catch(function () {\n            return false;\n          });\n        }\n      },\n      min: {\n        key: 'validate.min',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('min'), {\n            field: component.errorLabel,\n            min: parseFloat(setting),\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var min = parseFloat(setting);\n          var parsedValue = parseFloat(value);\n          if (Number.isNaN(min) || Number.isNaN(parsedValue)) {\n            return true;\n          }\n          return parsedValue >= min;\n        }\n      },\n      max: {\n        key: 'validate.max',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('max'), {\n            field: component.errorLabel,\n            max: parseFloat(setting),\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var max = parseFloat(setting);\n          var parsedValue = parseFloat(value);\n          if (Number.isNaN(max) || Number.isNaN(parsedValue)) {\n            return true;\n          }\n          return parsedValue <= max;\n        }\n      },\n      minSelectedCount: {\n        key: 'validate.minSelectedCount',\n        message: function message(component, setting) {\n          return component.component.minSelectedCountMessage ? component.component.minSelectedCountMessage : component.t(component.errorMessage('minSelectedCount'), {\n            minCount: parseFloat(setting),\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var min = parseFloat(setting);\n          if (!min) {\n            return true;\n          }\n          var count = Object.keys(value).reduce(function (total, key) {\n            if (value[key]) {\n              total++;\n            }\n            return total;\n          }, 0); // Should not be triggered if there is no options selected at all\n\n          return !count || count >= min;\n        }\n      },\n      maxSelectedCount: {\n        key: 'validate.maxSelectedCount',\n        message: function message(component, setting) {\n          return component.component.maxSelectedCountMessage ? component.component.maxSelectedCountMessage : component.t(component.errorMessage('maxSelectedCount'), {\n            minCount: parseFloat(setting),\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var max = parseFloat(setting);\n          if (!max) {\n            return true;\n          }\n          var count = Object.keys(value).reduce(function (total, key) {\n            if (value[key]) {\n              total++;\n            }\n            return total;\n          }, 0);\n          return count <= max;\n        }\n      },\n      minLength: {\n        key: 'validate.minLength',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('minLength'), {\n            field: component.errorLabel,\n            length: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var minLength = parseInt(setting, 10);\n          if (!value || !minLength || typeof value !== 'string' || component.isEmpty(value)) {\n            return true;\n          }\n          return value.length >= minLength;\n        }\n      },\n      maxLength: {\n        key: 'validate.maxLength',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('maxLength'), {\n            field: component.errorLabel,\n            length: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var maxLength = parseInt(setting, 10);\n          if (!maxLength || typeof value !== 'string') {\n            return true;\n          }\n          return value.length <= maxLength;\n        }\n      },\n      maxWords: {\n        key: 'validate.maxWords',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('maxWords'), {\n            field: component.errorLabel,\n            length: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var maxWords = parseInt(setting, 10);\n          if (!maxWords || typeof value !== 'string') {\n            return true;\n          }\n          return value.trim().split(/\\s+/).length <= maxWords;\n        }\n      },\n      minWords: {\n        key: 'validate.minWords',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('minWords'), {\n            field: component.errorLabel,\n            length: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var minWords = parseInt(setting, 10);\n          if (!minWords || !value || typeof value !== 'string') {\n            return true;\n          }\n          return value.trim().split(/\\s+/).length >= minWords;\n        }\n      },\n      email: {\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('invalid_email'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          /* eslint-disable max-len */\n          // From http://stackoverflow.com/questions/46155/validate-email-address-in-javascript\n          var re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n          /* eslint-enable max-len */\n          // Allow emails to be valid if the component is pristine and no value is provided.\n\n          return !value || re.test(value);\n        }\n      },\n      url: {\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('invalid_url'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          /* eslint-disable max-len */\n          // From https://stackoverflow.com/questions/8667070/javascript-regular-expression-to-validate-url\n          var re = /^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i; // From http://stackoverflow.com/questions/46155/validate-email-address-in-javascript\n\n          var emailRe = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n          /* eslint-enable max-len */\n          // Allow urls to be valid if the component is pristine and no value is provided.\n\n          return !value || re.test(value) && !emailRe.test(value);\n        }\n      },\n      date: {\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('invalid_date'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          return value !== 'Invalid date';\n        }\n      },\n      day: {\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('invalid_day'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          if (!value) {\n            return true;\n          }\n          var _ref = component.dayFirst ? [0, 1, 2] : [1, 0, 2],\n            _ref2 = _slicedToArray(_ref, 3),\n            DAY = _ref2[0],\n            MONTH = _ref2[1],\n            YEAR = _ref2[2];\n          var values = value.split('/').map(function (x) {\n              return parseInt(x, 10);\n            }),\n            day = values[DAY],\n            month = values[MONTH],\n            year = values[YEAR],\n            maxDay = getDaysInMonthCount(month, year);\n          if (day < 0 || day > maxDay) {\n            return false;\n          }\n          if (month < 0 || month > 12) {\n            return false;\n          }\n          if (year < 0 || year > 9999) {\n            return false;\n          }\n          return true;\n          function isLeapYear(year) {\n            // Year is leap if it is evenly divisible by 400 or evenly divisible by 4 and not evenly divisible by 100.\n            return !(year % 400) || !!(year % 100) && !(year % 4);\n          }\n          function getDaysInMonthCount(month, year) {\n            switch (month) {\n              case 1: // January\n\n              case 3: // March\n\n              case 5: // May\n\n              case 7: // July\n\n              case 8: // August\n\n              case 10: // October\n\n              case 12:\n                // December\n                return 31;\n              case 4: // April\n\n              case 6: // June\n\n              case 9: // September\n\n              case 11:\n                // November\n                return 30;\n              case 2:\n                // February\n                return isLeapYear(year) ? 29 : 28;\n              default:\n                return 31;\n            }\n          }\n        }\n      },\n      pattern: {\n        key: 'validate.pattern',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(_lodash.default.get(component, 'component.validate.patternMessage', component.errorMessage('pattern')), {\n            field: component.errorLabel,\n            pattern: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          if (component.isEmpty(value)) return true;\n          var pattern = setting;\n          if (!pattern) {\n            return true;\n          }\n          var regex = new RegExp(\"^\".concat(pattern, \"$\"));\n          return regex.test(value);\n        }\n      },\n      json: {\n        key: 'validate.json',\n        check: function check(component, setting, value, data, index, row) {\n          if (!setting) {\n            return true;\n          }\n          var valid = component.evaluate(setting, {\n            data: data,\n            row: row,\n            rowIndex: index,\n            input: value\n          });\n          if (valid === null) {\n            return true;\n          }\n          return valid;\n        }\n      },\n      mask: {\n        key: 'inputMask',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('mask'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var inputMask;\n          if (component.isMultipleMasksField) {\n            var maskName = value ? value.maskName : undefined;\n            var formioInputMask = component.getMaskByName(maskName);\n            if (formioInputMask) {\n              inputMask = formioInputMask;\n            }\n            value = value ? value.value : value;\n          } else {\n            inputMask = setting;\n          }\n          inputMask = inputMask ? (0, _utils.getInputMask)(inputMask) : null;\n          if (value && inputMask && !component.skipMaskValidation) {\n            // If char which is used inside mask placeholder was used in the mask, replace it with space to prevent errors\n            inputMask = inputMask.map(function (char) {\n              return char === component.placeholderChar ? ' ' : char;\n            });\n            return (0, _utils.matchInputMask)(value, inputMask);\n          }\n          return true;\n        }\n      },\n      custom: {\n        key: 'validate.custom',\n        message: function message(component) {\n          return component.t(component.errorMessage('custom'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value, data, index, row) {\n          if (!setting) {\n            return true;\n          }\n          var valid = component.evaluate(setting, {\n            valid: true,\n            data: data,\n            rowIndex: index,\n            row: row,\n            input: value\n          }, 'valid', true);\n          if (valid === null) {\n            return true;\n          }\n          return valid;\n        }\n      },\n      maxDate: {\n        key: 'maxDate',\n        hasLabel: true,\n        message: function message(component, setting) {\n          var date = (0, _utils.getDateSetting)(setting);\n          return component.t(component.errorMessage('maxDate'), {\n            field: component.errorLabel,\n            maxDate: (0, _moment.default)(date).format(component.format)\n          });\n        },\n        check: function check(component, setting, value) {\n          //if any parts of day are missing, skip maxDate validation\n          if (component.isPartialDay && component.isPartialDay(value)) {\n            return true;\n          }\n          var date = component.getValidationFormat ? (0, _moment.default)(value, component.getValidationFormat()) : (0, _moment.default)(value);\n          var maxDate = (0, _utils.getDateSetting)(setting);\n          if (_lodash.default.isNull(maxDate)) {\n            return true;\n          } else {\n            maxDate.setHours(0, 0, 0, 0);\n          }\n          return date.isBefore(maxDate) || date.isSame(maxDate);\n        }\n      },\n      minDate: {\n        key: 'minDate',\n        hasLabel: true,\n        message: function message(component, setting) {\n          var date = (0, _utils.getDateSetting)(setting);\n          return component.t(component.errorMessage('minDate'), {\n            field: component.errorLabel,\n            minDate: (0, _moment.default)(date).format(component.format)\n          });\n        },\n        check: function check(component, setting, value) {\n          //if any parts of day are missing, skip minDate validation\n          if (component.isPartialDay && component.isPartialDay(value)) {\n            return true;\n          }\n          var date = component.getValidationFormat ? (0, _moment.default)(value, component.getValidationFormat()) : (0, _moment.default)(value);\n          var minDate = (0, _utils.getDateSetting)(setting);\n          if (_lodash.default.isNull(minDate)) {\n            return true;\n          } else {\n            minDate.setHours(0, 0, 0, 0);\n          }\n          return date.isAfter(minDate) || date.isSame(minDate);\n        }\n      },\n      minYear: {\n        key: 'minYear',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('minYear'), {\n            field: component.errorLabel,\n            minYear: setting\n          });\n        },\n        check: function check(component, setting, value) {\n          var minYear = setting;\n          var year = /\\d{4}$/.exec(value);\n          year = year ? year[0] : null;\n          if (!+minYear || !+year) {\n            return true;\n          }\n          return +year >= +minYear;\n        }\n      },\n      maxYear: {\n        key: 'maxYear',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('maxYear'), {\n            field: component.errorLabel,\n            maxYear: setting\n          });\n        },\n        check: function check(component, setting, value) {\n          var maxYear = setting;\n          var year = /\\d{4}$/.exec(value);\n          year = year ? year[0] : null;\n          if (!+maxYear || !+year) {\n            return true;\n          }\n          return +year <= +maxYear;\n        }\n      },\n      calendar: {\n        key: 'validate.calendar',\n        messageText: '',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage(this.validators.calendar.messageText), {\n            field: component.errorLabel,\n            maxDate: (0, _moment.default)(component.dataValue).format(component.format)\n          });\n        },\n        check: function check(component, setting, value, data, index) {\n          this.validators.calendar.messageText = '';\n          var widget = component.getWidget(index);\n          if (!widget) {\n            return true;\n          }\n          var settings = widget.settings,\n            enteredDate = widget.enteredDate;\n          var minDate = settings.minDate,\n            maxDate = settings.maxDate,\n            format = settings.format;\n          var momentFormat = [(0, _utils.convertFormatToMoment)(format)];\n          if (momentFormat[0].match(/M{3,}/g)) {\n            momentFormat.push(momentFormat[0].replace(/M{3,}/g, 'MM'));\n          }\n          if (!value && enteredDate) {\n            var _checkInvalidDate = (0, _calendarUtils.checkInvalidDate)(enteredDate, momentFormat, minDate, maxDate),\n              message = _checkInvalidDate.message,\n              result = _checkInvalidDate.result;\n            if (!result) {\n              this.validators.calendar.messageText = message;\n              return result;\n            }\n          }\n          if (value && enteredDate) {\n            if ((0, _moment.default)(value).format() !== (0, _moment.default)(enteredDate, momentFormat, true).format() && enteredDate.match(/_/gi)) {\n              this.validators.calendar.messageText = _calendarUtils.CALENDAR_ERROR_MESSAGES.INCOMPLETE;\n              return false;\n            } else {\n              widget.enteredDate = '';\n              return true;\n            }\n          }\n        }\n      },\n      time: {\n        key: 'validate.time',\n        messageText: 'Invalid time',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage(this.validators.time.messageText), {\n            field: component.errorLabel\n          });\n        },\n        check: function check(component, setting, value) {\n          if (component.isEmpty(value)) return true;\n          return (0, _moment.default)(value, component.component.format).isValid();\n        }\n      }\n    };\n  }\n  _createClass(ValidationChecker, [{\n    key: \"checkValidator\",\n    value: function checkValidator(component, validator, setting, value, data, index, row, async) {\n      var _this2 = this;\n      var resultOrPromise = null; // Allow each component to override their own validators by implementing the validator.method\n\n      if (validator.method && typeof component[validator.method] === 'function') {\n        resultOrPromise = component[validator.method](setting, value, data, index, row, async);\n      } else {\n        resultOrPromise = validator.check.call(this, component, setting, value, data, index, row, async);\n      }\n      var processResult = function processResult(result) {\n        if (typeof result === 'string') {\n          return result;\n        }\n        if (!result && validator.message) {\n          return validator.message.call(_this2, component, setting, index, row);\n        }\n        return '';\n      };\n      if (async) {\n        return _nativePromiseOnly.default.resolve(resultOrPromise).then(processResult);\n      } else {\n        return processResult(resultOrPromise);\n      }\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(component, validatorName, value, data, index, row, async, conditionallyVisible, validationObj) {\n      // Skip validation for conditionally hidden components\n      if (!conditionallyVisible) {\n        return false;\n      }\n      var validator = this.validators[validatorName];\n      var setting = _lodash.default.get(validationObj || component.component, validator.key, null);\n      var resultOrPromise = this.checkValidator(component, validator, setting, value, data, index, row, async);\n      var processResult = function processResult(result) {\n        if (result) {\n          var _component$refs$input;\n          var resultData = {\n            message: (0, _utils.unescapeHTML)(_lodash.default.get(result, 'message', result)),\n            level: _lodash.default.get(result, 'level') === 'warning' ? 'warning' : 'error',\n            path: (0, _utils.getArrayFromComponentPath)(component.path || ''),\n            context: {\n              validator: validatorName,\n              hasLabel: validator.hasLabel,\n              setting: setting,\n              key: component.key,\n              label: component.label,\n              value: value,\n              index: index,\n              input: (_component$refs$input = component.refs.input) === null || _component$refs$input === void 0 ? void 0 : _component$refs$input[index]\n            }\n          };\n          if (validatorName === 'unique' && component.conflictId) {\n            resultData.conflictId = component.conflictId;\n          }\n          return resultData;\n        } else {\n          return false;\n        }\n      };\n      if (async) {\n        return _nativePromiseOnly.default.resolve(resultOrPromise).then(processResult);\n      } else {\n        return processResult(resultOrPromise);\n      }\n    }\n  }, {\n    key: \"checkComponent\",\n    value: function checkComponent(component, data, row) {\n      var _component$addons,\n        _this3 = this;\n      var includeWarnings = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      var async = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n      var isServerSidePersistent = typeof process !== 'undefined' && _lodash.default.get(process, 'release.name') === 'node' && !_lodash.default.defaultTo(component.component.persistent, true); // If we're server-side and it's not a persistent component, don't run validation at all\n\n      if (isServerSidePersistent || component.component.validate === false) {\n        return async ? _nativePromiseOnly.default.resolve([]) : [];\n      }\n      data = data || component.rootValue;\n      row = row || component.data;\n      var values = component.component.multiple && Array.isArray(component.validationValue) ? component.validationValue : [component.validationValue];\n      var conditionallyVisible = component.conditionallyVisible();\n      var addonsValidations = [];\n      if (component !== null && component !== void 0 && (_component$addons = component.addons) !== null && _component$addons !== void 0 && _component$addons.length) {\n        values.forEach(function (value) {\n          component.addons.forEach(function (addon) {\n            if (!addon.checkValidity(value)) {\n              addonsValidations.push.apply(addonsValidations, _toConsumableArray(addon.errors || []));\n            }\n          });\n        });\n      } // If this component has the new validation system enabled, use it instead.\n\n      var validations = _lodash.default.get(component, 'component.validations');\n      var nextGenResultsOrPromises = [];\n      if (validations && Array.isArray(validations) && validations.length) {\n        var validationsGroupedByMode = _lodash.default.chain(validations).groupBy(function (validation) {\n          return validation.mode;\n        }).value();\n        if (component.calculateCondition) {\n          includeWarnings = true;\n          var uiGroupedValidation = _lodash.default.chain(validationsGroupedByMode.ui).filter('active').groupBy(function (validation) {\n            return validation.group || null;\n          }).value();\n          var commonValidations = uiGroupedValidation.null || [];\n          delete uiGroupedValidation.null;\n          commonValidations.forEach(function (_ref3) {\n            var condition = _ref3.condition,\n              message = _ref3.message,\n              severity = _ref3.severity;\n            if (!component.calculateCondition(condition)) {\n              nextGenResultsOrPromises.push({\n                level: severity || 'error',\n                message: component.t(message),\n                componentInstance: component\n              });\n            }\n          });\n          _lodash.default.forEach(uiGroupedValidation, function (validationGroup) {\n            _lodash.default.forEach(validationGroup, function (_ref4) {\n              var condition = _ref4.condition,\n                message = _ref4.message,\n                severity = _ref4.severity;\n              if (!component.calculateCondition(condition)) {\n                nextGenResultsOrPromises.push({\n                  level: severity || 'error',\n                  message: component.t(message),\n                  componentInstance: component\n                });\n                return false;\n              }\n            });\n          });\n        } else {\n          nextGenResultsOrPromises = this.checkValidations(component, validations, data, row, values, async);\n        }\n        if (component.validators.includes('custom') && validationsGroupedByMode.js) {\n          _lodash.default.each(validationsGroupedByMode.js, function (validation) {\n            nextGenResultsOrPromises.push(_lodash.default.map(values, function (value, index) {\n              return _this3.validate(component, 'custom', value, data, index, row, async, conditionallyVisible, validation);\n            }));\n          });\n        }\n        if (component.validators.includes('json') && validationsGroupedByMode.json) {\n          _lodash.default.each(validationsGroupedByMode.json, function (validation) {\n            nextGenResultsOrPromises.push(_lodash.default.map(values, function (value, index) {\n              return _this3.validate(component, 'json', value, data, index, row, async, conditionallyVisible, validation);\n            }));\n          });\n        }\n      }\n      var validateCustom = _lodash.default.get(component, 'component.validate.custom');\n      var customErrorMessage = _lodash.default.get(component, 'component.validate.customMessage'); // Run primary validators\n\n      var resultsOrPromises = (0, _lodash.default)(component.validators).chain().map(function (validatorName) {\n        if (!_this3.validators.hasOwnProperty(validatorName)) {\n          return {\n            message: \"Validator for \\\"\".concat(validatorName, \"\\\" is not defined\"),\n            level: 'warning',\n            context: {\n              validator: validatorName,\n              key: component.key,\n              label: component.label\n            }\n          };\n        } // Handle the case when there is no values defined and it is required.\n\n        if (validatorName === 'required' && !values.length) {\n          return [_this3.validate(component, validatorName, null, data, 0, row, async, conditionallyVisible)];\n        }\n        return _lodash.default.map(values, function (value, index) {\n          return _this3.validate(component, validatorName, value, data, index, row, async, conditionallyVisible);\n        });\n      }).flatten().value(); // Run the \"unique\" pseudo-validator\n\n      component.component.validate = component.component.validate || {};\n      component.component.validate.unique = component.component.unique;\n      resultsOrPromises.push(this.validate(component, 'unique', component.validationValue, data, 0, data, async, conditionallyVisible)); // Run the \"multiple\" pseudo-validator\n\n      component.component.validate.multiple = component.component.multiple;\n      resultsOrPromises.push(this.validate(component, 'multiple', component.validationValue, data, 0, data, async, conditionallyVisible));\n      resultsOrPromises.push.apply(resultsOrPromises, addonsValidations);\n      resultsOrPromises.push.apply(resultsOrPromises, _toConsumableArray(nextGenResultsOrPromises)); // Define how results should be formatted\n\n      var formatResults = function formatResults(results) {\n        // Condense to a single flat array\n        results = (0, _lodash.default)(results).chain().flatten().compact().value();\n        if (customErrorMessage || validateCustom) {\n          _lodash.default.each(results, function (result) {\n            result.message = component.t(customErrorMessage || result.message, {\n              field: component.errorLabel,\n              data: data,\n              row: row,\n              error: result\n            });\n            result.context.hasLabel = false;\n          });\n        }\n        return includeWarnings ? results : _lodash.default.reject(results, function (result) {\n          return result.level === 'warning';\n        });\n      }; // Wait for results if using async mode, otherwise process and return immediately\n\n      if (async) {\n        return _nativePromiseOnly.default.all(resultsOrPromises).then(formatResults);\n      } else {\n        return formatResults(resultsOrPromises);\n      }\n    }\n    /**\n     * Use the new validations engine to evaluate any errors.\n     *\n     * @param component\n     * @param validations\n     * @param data\n     * @param row\n     * @param values\n     * @returns {any[]}\n     */\n  }, {\n    key: \"checkValidations\",\n    value: function checkValidations(component, validations, data, row, values, async) {\n      var _this4 = this;\n\n      // Get results.\n      var results = validations.map(function (validation) {\n        return _this4.checkRule(component, validation, data, row, values, async);\n      }); // Flatten array and filter out empty results.\n\n      var messages = results.reduce(function (prev, result) {\n        if (result) {\n          return [].concat(_toConsumableArray(prev), _toConsumableArray(result));\n        }\n        return prev;\n      }, []).filter(function (result) {\n        return result;\n      }); // Keep only the last error for each rule.\n\n      var rules = messages.reduce(function (prev, message) {\n        prev[message.context.validator] = message;\n        return prev;\n      }, {});\n      return Object.values(rules);\n    }\n  }, {\n    key: \"checkRule\",\n    value: function checkRule(component, validation, data, row, values, async) {\n      var Rule = _Rules.default.getRule(validation.rule);\n      var results = [];\n      if (Rule) {\n        var rule = new Rule(component, validation.settings, this.config);\n        values.map(function (value, index) {\n          var result = rule.check(value, data, row, async);\n          if (result !== true) {\n            results.push({\n              level: validation.level || 'error',\n              message: component.t(validation.message || rule.defaultMessage, {\n                settings: validation.settings,\n                field: component.errorLabel,\n                data: data,\n                row: row,\n                error: result\n              }),\n              context: {\n                key: component.key,\n                index: index,\n                label: component.label,\n                validator: validation.rule\n              }\n            });\n          }\n        });\n      } // If there are no results, return false so it is removed by filter.\n\n      return results.length === 0 ? false : results;\n    }\n  }, {\n    key: \"check\",\n    get: function get() {\n      return this.checkComponent;\n    }\n  }, {\n    key: \"get\",\n    value: function get() {\n      _lodash.default.get.call(this, arguments);\n    }\n  }, {\n    key: \"each\",\n    value: function each() {\n      _lodash.default.each.call(this, arguments);\n    }\n  }, {\n    key: \"has\",\n    value: function has() {\n      _lodash.default.has.call(this, arguments);\n    }\n  }]);\n  return ValidationChecker;\n}();\nexports.ValidationChecker = ValidationChecker;\nValidationChecker.config = {\n  db: null,\n  token: null,\n  form: null,\n  submission: null\n};\nvar instance = new ValidationChecker();\nexports.default = instance;","map":{"version":3,"names":["require","Object","defineProperty","exports","value","default","ValidationChecker","_lodash","_interopRequireDefault","_utils","_moment","_nativePromiseOnly","_fetchPonyfill2","_calendarUtils","_Rules","obj","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","Array","from","isArray","_arrayLikeToArray","_slicedToArray","i","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","o","minLen","n","prototype","toString","call","slice","constructor","name","test","len","length","arr2","_i","_arr","_n","_d","_s","_e","next","done","push","err","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","_fetchPonyfill","Promise","fetch","Headers","Request","config","arguments","undefined","defaults","validators","required","method","hasLabel","message","component","t","errorMessage","field","errorLabel","data","check","setting","boolValue","isValueHidden","isCalendar","some","validator","widget","enteredDate","calendar","isEmpty","onlyAvailableItems","unique","_this","isObjectLike","db","resolve","form","submission","path","concat","addPathQueryParams","pathQueryParams","query","pathArray","split","needValuesInArray","pathToValue","shift","pathQueryObj","reduce","pathQueryPath","pathPart","index","isLastPathPart","get","addedPath","set","_id","isString","dbIndex","$regex","RegExp","escapeRegExCharacters","$options","isPlainObject","address","$all","isObject","isNumber","$eq","deleted","findOne","result","conflictId","catch","multiple","shouldBeArray","emptyValue","isRequired","validate","messageKey","validateMultiple","canBeArray","isNil","select","row","async","schema","requestOptions","url","qs","json","headers","isBoolean","dataSrc","searchField","filter","includes","selectFields","interpolate","chain","map","val","encodeURIComponent","join","each","header","authenticate","token","then","response","ok","results","min","parseFloat","parsedValue","Number","isNaN","max","minSelectedCount","minSelectedCountMessage","minCount","count","keys","total","maxSelectedCount","maxSelectedCountMessage","minLength","parseInt","maxLength","maxWords","trim","minWords","email","re","emailRe","date","day","_ref","dayFirst","_ref2","DAY","MONTH","YEAR","values","x","month","year","maxDay","getDaysInMonthCount","isLeapYear","pattern","regex","valid","evaluate","rowIndex","input","mask","inputMask","isMultipleMasksField","maskName","formioInputMask","getMaskByName","getInputMask","skipMaskValidation","char","placeholderChar","matchInputMask","custom","maxDate","getDateSetting","format","isPartialDay","getValidationFormat","isNull","setHours","isBefore","isSame","minDate","isAfter","minYear","exec","maxYear","messageText","dataValue","getWidget","settings","momentFormat","convertFormatToMoment","match","replace","_checkInvalidDate","checkInvalidDate","CALENDAR_ERROR_MESSAGES","INCOMPLETE","time","isValid","checkValidator","_this2","resultOrPromise","processResult","validatorName","conditionallyVisible","validationObj","_component$refs$input","resultData","unescapeHTML","level","getArrayFromComponentPath","context","label","refs","checkComponent","_component$addons","_this3","includeWarnings","isServerSidePersistent","process","defaultTo","persistent","rootValue","validationValue","addonsValidations","addons","forEach","addon","checkValidity","apply","errors","validations","nextGenResultsOrPromises","validationsGroupedByMode","groupBy","validation","mode","calculateCondition","uiGroupedValidation","ui","group","commonValidations","null","_ref3","condition","severity","componentInstance","validationGroup","_ref4","checkValidations","js","validateCustom","customErrorMessage","resultsOrPromises","hasOwnProperty","flatten","formatResults","compact","error","reject","all","_this4","checkRule","messages","prev","rules","Rule","getRule","rule","defaultMessage","has"],"sources":["D:/task/node_modules/formiojs/validator/Validator.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.symbol.js\");\n\nrequire(\"core-js/modules/es.symbol.description.js\");\n\nrequire(\"core-js/modules/es.symbol.iterator.js\");\n\nrequire(\"core-js/modules/es.array.iterator.js\");\n\nrequire(\"core-js/modules/es.string.iterator.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nrequire(\"core-js/modules/es.array.slice.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nrequire(\"core-js/modules/es.array.from.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.ValidationChecker = void 0;\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.split.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/es.regexp.constructor.js\");\n\nrequire(\"core-js/modules/es.regexp.to-string.js\");\n\nrequire(\"core-js/modules/es.array.filter.js\");\n\nrequire(\"core-js/modules/es.array.includes.js\");\n\nrequire(\"core-js/modules/es.string.includes.js\");\n\nrequire(\"core-js/modules/es.array.join.js\");\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.number.is-nan.js\");\n\nrequire(\"core-js/modules/es.number.constructor.js\");\n\nrequire(\"core-js/modules/es.object.keys.js\");\n\nrequire(\"core-js/modules/es.string.trim.js\");\n\nrequire(\"core-js/modules/es.string.match.js\");\n\nrequire(\"core-js/modules/es.string.replace.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.object.values.js\");\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _utils = require(\"../utils/utils\");\n\nvar _moment = _interopRequireDefault(require(\"moment\"));\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _fetchPonyfill2 = _interopRequireDefault(require(\"fetch-ponyfill\"));\n\nvar _calendarUtils = require(\"../utils/calendarUtils\");\n\nvar _Rules = _interopRequireDefault(require(\"./Rules\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nvar _fetchPonyfill = (0, _fetchPonyfill2.default)({\n  Promise: _nativePromiseOnly.default\n}),\n    fetch = _fetchPonyfill.fetch,\n    Headers = _fetchPonyfill.Headers,\n    Request = _fetchPonyfill.Request;\n\nvar ValidationChecker = /*#__PURE__*/function () {\n  function ValidationChecker() {\n    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, ValidationChecker);\n\n    this.config = _lodash.default.defaults(config, ValidationChecker.config);\n    this.validators = {\n      required: {\n        key: 'validate.required',\n        method: 'validateRequired',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('required'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          if (!(0, _utils.boolValue)(setting) || component.isValueHidden()) {\n            return true;\n          }\n\n          var isCalendar = component.validators.some(function (validator) {\n            return validator === 'calendar';\n          });\n\n          if (!value && isCalendar && component.widget.enteredDate) {\n            return !this.validators.calendar.check.call(this, component, setting, value);\n          }\n\n          return !component.isEmpty(value);\n        }\n      },\n      onlyAvailableItems: {\n        key: 'validate.onlyAvailableItems',\n        method: 'validateValueAvailability',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('valueIsNotAvailable'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting) {\n          return !(0, _utils.boolValue)(setting);\n        }\n      },\n      unique: {\n        key: 'validate.unique',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('unique'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var _this = this;\n\n          // Skip if setting is falsy\n          if (!(0, _utils.boolValue)(setting)) {\n            return true;\n          } // Skip if value is empty object or falsy\n\n\n          if (!value || _lodash.default.isObjectLike(value) && _lodash.default.isEmpty(value)) {\n            return true;\n          } // Skip if we don't have a database connection\n\n\n          if (!this.config.db) {\n            return true;\n          }\n\n          return new _nativePromiseOnly.default(function (resolve) {\n            var form = _this.config.form;\n            var submission = _this.config.submission;\n            var path = \"data.\".concat(component.path);\n\n            var addPathQueryParams = function addPathQueryParams(pathQueryParams, query, path) {\n              var pathArray = path.split(/\\[\\d+\\]?./);\n              var needValuesInArray = pathArray.length > 1;\n              var pathToValue = path;\n\n              if (needValuesInArray) {\n                pathToValue = pathArray.shift();\n                var pathQueryObj = {};\n\n                _lodash.default.reduce(pathArray, function (pathQueryPath, pathPart, index) {\n                  var isLastPathPart = index === pathArray.length - 1;\n\n                  var obj = _lodash.default.get(pathQueryObj, pathQueryPath, pathQueryObj);\n\n                  var addedPath = \"$elemMatch['\".concat(pathPart, \"']\");\n\n                  _lodash.default.set(obj, addedPath, isLastPathPart ? pathQueryParams : {});\n\n                  return pathQueryPath ? \"\".concat(pathQueryPath, \".\").concat(addedPath) : addedPath;\n                }, '');\n\n                query[pathToValue] = pathQueryObj;\n              } else {\n                query[pathToValue] = pathQueryParams;\n              }\n            }; // Build the query\n\n\n            var query = {\n              form: form._id\n            };\n\n            if (_lodash.default.isString(value)) {\n              if (component.component.dbIndex) {\n                addPathQueryParams(value, query, path);\n              } else {\n                addPathQueryParams({\n                  $regex: new RegExp(\"^\".concat((0, _utils.escapeRegExCharacters)(value), \"$\")),\n                  $options: 'i'\n                }, query, path);\n              }\n            } // FOR-213 - Pluck the unique location id\n            else if (_lodash.default.isPlainObject(value) && value.address && value.address['address_components'] && value.address['place_id']) {\n              addPathQueryParams({\n                $regex: new RegExp(\"^\".concat((0, _utils.escapeRegExCharacters)(value.address['place_id']), \"$\")),\n                $options: 'i'\n              }, query, \"\".concat(path, \".address.place_id\"));\n            } // Compare the contents of arrays vs the order.\n            else if (_lodash.default.isArray(value)) {\n              addPathQueryParams({\n                $all: value\n              }, query, path);\n            } else if (_lodash.default.isObject(value) || _lodash.default.isNumber(value)) {\n              addPathQueryParams({\n                $eq: value\n              }, query, path);\n            } // Only search for non-deleted items\n\n\n            query.deleted = {\n              $eq: null\n            }; // Try to find an existing value within the form\n\n            _this.config.db.findOne(query, function (err, result) {\n              if (err) {\n                return resolve(false);\n              } else if (result) {\n                // Only OK if it matches the current submission\n                if (submission._id && result._id.toString() === submission._id) {\n                  resolve(true);\n                } else {\n                  component.conflictId = result._id.toString();\n                  return resolve(false);\n                }\n              } else {\n                return resolve(true);\n              }\n            });\n          }).catch(function () {\n            return false;\n          });\n        }\n      },\n      multiple: {\n        key: 'validate.multiple',\n        hasLabel: true,\n        message: function message(component) {\n          var shouldBeArray = (0, _utils.boolValue)(component.component.multiple) || Array.isArray(component.emptyValue);\n          var isRequired = component.component.validate.required;\n          var messageKey = shouldBeArray ? isRequired ? 'array_nonempty' : 'array' : 'nonarray';\n          return component.t(component.errorMessage(messageKey), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          // Skip multiple validation if the component tells us to\n          if (!component.validateMultiple()) {\n            return true;\n          }\n\n          var shouldBeArray = (0, _utils.boolValue)(setting);\n          var canBeArray = Array.isArray(component.emptyValue);\n          var isArray = Array.isArray(value);\n          var isRequired = component.component.validate.required;\n\n          if (shouldBeArray) {\n            if (isArray) {\n              return isRequired ? !!value.length : true;\n            } else {\n              // Null/undefined is ok if this value isn't required; anything else should fail\n              return _lodash.default.isNil(value) ? !isRequired : false;\n            }\n          } else {\n            return canBeArray || !isArray;\n          }\n        }\n      },\n      select: {\n        key: 'validate.select',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('select'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value, data, index, row, async) {\n          // Skip if setting is falsy\n          if (!(0, _utils.boolValue)(setting)) {\n            return true;\n          } // Skip if value is empty\n\n\n          if (!value || _lodash.default.isEmpty(value)) {\n            return true;\n          } // Skip if we're not async-capable\n\n\n          if (!async) {\n            return true;\n          }\n\n          var schema = component.component; // Initialize the request options\n\n          var requestOptions = {\n            url: setting,\n            method: 'GET',\n            qs: {},\n            json: true,\n            headers: {}\n          }; // If the url is a boolean value\n\n          if (_lodash.default.isBoolean(requestOptions.url)) {\n            requestOptions.url = !!requestOptions.url;\n\n            if (!requestOptions.url || schema.dataSrc !== 'url' || !schema.data.url || !schema.searchField) {\n              return true;\n            } // Get the validation url\n\n\n            requestOptions.url = schema.data.url; // Add the search field\n\n            requestOptions.qs[schema.searchField] = value; // Add the filters\n\n            if (schema.filter) {\n              requestOptions.url += (!requestOptions.url.includes('?') ? '?' : '&') + schema.filter;\n            } // If they only wish to return certain fields.\n\n\n            if (schema.selectFields) {\n              requestOptions.qs.select = schema.selectFields;\n            }\n          }\n\n          if (!requestOptions.url) {\n            return true;\n          } // Make sure to interpolate.\n\n\n          requestOptions.url = (0, _utils.interpolate)(requestOptions.url, {\n            data: component.data\n          }); // Add query string to URL\n\n          requestOptions.url += (requestOptions.url.includes('?') ? '&' : '?') + _lodash.default.chain(requestOptions.qs).map(function (val, key) {\n            return \"\".concat(encodeURIComponent(key), \"=\").concat(encodeURIComponent(val));\n          }).join('&').value(); // Set custom headers.\n\n          if (schema.data && schema.data.headers) {\n            _lodash.default.each(schema.data.headers, function (header) {\n              if (header.key) {\n                requestOptions.headers[header.key] = header.value;\n              }\n            });\n          } // Set form.io authentication.\n\n\n          if (schema.authenticate && this.config.token) {\n            requestOptions.headers['x-jwt-token'] = this.config.token;\n          }\n\n          return fetch(new Request(requestOptions.url, {\n            headers: new Headers(requestOptions.headers)\n          })).then(function (response) {\n            if (!response.ok) {\n              return false;\n            }\n\n            return response.json();\n          }).then(function (results) {\n            return results && results.length;\n          }).catch(function () {\n            return false;\n          });\n        }\n      },\n      min: {\n        key: 'validate.min',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('min'), {\n            field: component.errorLabel,\n            min: parseFloat(setting),\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var min = parseFloat(setting);\n          var parsedValue = parseFloat(value);\n\n          if (Number.isNaN(min) || Number.isNaN(parsedValue)) {\n            return true;\n          }\n\n          return parsedValue >= min;\n        }\n      },\n      max: {\n        key: 'validate.max',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('max'), {\n            field: component.errorLabel,\n            max: parseFloat(setting),\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var max = parseFloat(setting);\n          var parsedValue = parseFloat(value);\n\n          if (Number.isNaN(max) || Number.isNaN(parsedValue)) {\n            return true;\n          }\n\n          return parsedValue <= max;\n        }\n      },\n      minSelectedCount: {\n        key: 'validate.minSelectedCount',\n        message: function message(component, setting) {\n          return component.component.minSelectedCountMessage ? component.component.minSelectedCountMessage : component.t(component.errorMessage('minSelectedCount'), {\n            minCount: parseFloat(setting),\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var min = parseFloat(setting);\n\n          if (!min) {\n            return true;\n          }\n\n          var count = Object.keys(value).reduce(function (total, key) {\n            if (value[key]) {\n              total++;\n            }\n\n            return total;\n          }, 0); // Should not be triggered if there is no options selected at all\n\n          return !count || count >= min;\n        }\n      },\n      maxSelectedCount: {\n        key: 'validate.maxSelectedCount',\n        message: function message(component, setting) {\n          return component.component.maxSelectedCountMessage ? component.component.maxSelectedCountMessage : component.t(component.errorMessage('maxSelectedCount'), {\n            minCount: parseFloat(setting),\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var max = parseFloat(setting);\n\n          if (!max) {\n            return true;\n          }\n\n          var count = Object.keys(value).reduce(function (total, key) {\n            if (value[key]) {\n              total++;\n            }\n\n            return total;\n          }, 0);\n          return count <= max;\n        }\n      },\n      minLength: {\n        key: 'validate.minLength',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('minLength'), {\n            field: component.errorLabel,\n            length: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var minLength = parseInt(setting, 10);\n\n          if (!value || !minLength || typeof value !== 'string' || component.isEmpty(value)) {\n            return true;\n          }\n\n          return value.length >= minLength;\n        }\n      },\n      maxLength: {\n        key: 'validate.maxLength',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('maxLength'), {\n            field: component.errorLabel,\n            length: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var maxLength = parseInt(setting, 10);\n\n          if (!maxLength || typeof value !== 'string') {\n            return true;\n          }\n\n          return value.length <= maxLength;\n        }\n      },\n      maxWords: {\n        key: 'validate.maxWords',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('maxWords'), {\n            field: component.errorLabel,\n            length: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var maxWords = parseInt(setting, 10);\n\n          if (!maxWords || typeof value !== 'string') {\n            return true;\n          }\n\n          return value.trim().split(/\\s+/).length <= maxWords;\n        }\n      },\n      minWords: {\n        key: 'validate.minWords',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('minWords'), {\n            field: component.errorLabel,\n            length: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var minWords = parseInt(setting, 10);\n\n          if (!minWords || !value || typeof value !== 'string') {\n            return true;\n          }\n\n          return value.trim().split(/\\s+/).length >= minWords;\n        }\n      },\n      email: {\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('invalid_email'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          /* eslint-disable max-len */\n          // From http://stackoverflow.com/questions/46155/validate-email-address-in-javascript\n          var re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n          /* eslint-enable max-len */\n          // Allow emails to be valid if the component is pristine and no value is provided.\n\n          return !value || re.test(value);\n        }\n      },\n      url: {\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('invalid_url'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          /* eslint-disable max-len */\n          // From https://stackoverflow.com/questions/8667070/javascript-regular-expression-to-validate-url\n          var re = /^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i; // From http://stackoverflow.com/questions/46155/validate-email-address-in-javascript\n\n          var emailRe = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n          /* eslint-enable max-len */\n          // Allow urls to be valid if the component is pristine and no value is provided.\n\n          return !value || re.test(value) && !emailRe.test(value);\n        }\n      },\n      date: {\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('invalid_date'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          return value !== 'Invalid date';\n        }\n      },\n      day: {\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('invalid_day'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          if (!value) {\n            return true;\n          }\n\n          var _ref = component.dayFirst ? [0, 1, 2] : [1, 0, 2],\n              _ref2 = _slicedToArray(_ref, 3),\n              DAY = _ref2[0],\n              MONTH = _ref2[1],\n              YEAR = _ref2[2];\n\n          var values = value.split('/').map(function (x) {\n            return parseInt(x, 10);\n          }),\n              day = values[DAY],\n              month = values[MONTH],\n              year = values[YEAR],\n              maxDay = getDaysInMonthCount(month, year);\n\n          if (day < 0 || day > maxDay) {\n            return false;\n          }\n\n          if (month < 0 || month > 12) {\n            return false;\n          }\n\n          if (year < 0 || year > 9999) {\n            return false;\n          }\n\n          return true;\n\n          function isLeapYear(year) {\n            // Year is leap if it is evenly divisible by 400 or evenly divisible by 4 and not evenly divisible by 100.\n            return !(year % 400) || !!(year % 100) && !(year % 4);\n          }\n\n          function getDaysInMonthCount(month, year) {\n            switch (month) {\n              case 1: // January\n\n              case 3: // March\n\n              case 5: // May\n\n              case 7: // July\n\n              case 8: // August\n\n              case 10: // October\n\n              case 12:\n                // December\n                return 31;\n\n              case 4: // April\n\n              case 6: // June\n\n              case 9: // September\n\n              case 11:\n                // November\n                return 30;\n\n              case 2:\n                // February\n                return isLeapYear(year) ? 29 : 28;\n\n              default:\n                return 31;\n            }\n          }\n        }\n      },\n      pattern: {\n        key: 'validate.pattern',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(_lodash.default.get(component, 'component.validate.patternMessage', component.errorMessage('pattern')), {\n            field: component.errorLabel,\n            pattern: setting,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          if (component.isEmpty(value)) return true;\n          var pattern = setting;\n\n          if (!pattern) {\n            return true;\n          }\n\n          var regex = new RegExp(\"^\".concat(pattern, \"$\"));\n          return regex.test(value);\n        }\n      },\n      json: {\n        key: 'validate.json',\n        check: function check(component, setting, value, data, index, row) {\n          if (!setting) {\n            return true;\n          }\n\n          var valid = component.evaluate(setting, {\n            data: data,\n            row: row,\n            rowIndex: index,\n            input: value\n          });\n\n          if (valid === null) {\n            return true;\n          }\n\n          return valid;\n        }\n      },\n      mask: {\n        key: 'inputMask',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage('mask'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value) {\n          var inputMask;\n\n          if (component.isMultipleMasksField) {\n            var maskName = value ? value.maskName : undefined;\n            var formioInputMask = component.getMaskByName(maskName);\n\n            if (formioInputMask) {\n              inputMask = formioInputMask;\n            }\n\n            value = value ? value.value : value;\n          } else {\n            inputMask = setting;\n          }\n\n          inputMask = inputMask ? (0, _utils.getInputMask)(inputMask) : null;\n\n          if (value && inputMask && !component.skipMaskValidation) {\n            // If char which is used inside mask placeholder was used in the mask, replace it with space to prevent errors\n            inputMask = inputMask.map(function (char) {\n              return char === component.placeholderChar ? ' ' : char;\n            });\n            return (0, _utils.matchInputMask)(value, inputMask);\n          }\n\n          return true;\n        }\n      },\n      custom: {\n        key: 'validate.custom',\n        message: function message(component) {\n          return component.t(component.errorMessage('custom'), {\n            field: component.errorLabel,\n            data: component.data\n          });\n        },\n        check: function check(component, setting, value, data, index, row) {\n          if (!setting) {\n            return true;\n          }\n\n          var valid = component.evaluate(setting, {\n            valid: true,\n            data: data,\n            rowIndex: index,\n            row: row,\n            input: value\n          }, 'valid', true);\n\n          if (valid === null) {\n            return true;\n          }\n\n          return valid;\n        }\n      },\n      maxDate: {\n        key: 'maxDate',\n        hasLabel: true,\n        message: function message(component, setting) {\n          var date = (0, _utils.getDateSetting)(setting);\n          return component.t(component.errorMessage('maxDate'), {\n            field: component.errorLabel,\n            maxDate: (0, _moment.default)(date).format(component.format)\n          });\n        },\n        check: function check(component, setting, value) {\n          //if any parts of day are missing, skip maxDate validation\n          if (component.isPartialDay && component.isPartialDay(value)) {\n            return true;\n          }\n\n          var date = component.getValidationFormat ? (0, _moment.default)(value, component.getValidationFormat()) : (0, _moment.default)(value);\n          var maxDate = (0, _utils.getDateSetting)(setting);\n\n          if (_lodash.default.isNull(maxDate)) {\n            return true;\n          } else {\n            maxDate.setHours(0, 0, 0, 0);\n          }\n\n          return date.isBefore(maxDate) || date.isSame(maxDate);\n        }\n      },\n      minDate: {\n        key: 'minDate',\n        hasLabel: true,\n        message: function message(component, setting) {\n          var date = (0, _utils.getDateSetting)(setting);\n          return component.t(component.errorMessage('minDate'), {\n            field: component.errorLabel,\n            minDate: (0, _moment.default)(date).format(component.format)\n          });\n        },\n        check: function check(component, setting, value) {\n          //if any parts of day are missing, skip minDate validation\n          if (component.isPartialDay && component.isPartialDay(value)) {\n            return true;\n          }\n\n          var date = component.getValidationFormat ? (0, _moment.default)(value, component.getValidationFormat()) : (0, _moment.default)(value);\n          var minDate = (0, _utils.getDateSetting)(setting);\n\n          if (_lodash.default.isNull(minDate)) {\n            return true;\n          } else {\n            minDate.setHours(0, 0, 0, 0);\n          }\n\n          return date.isAfter(minDate) || date.isSame(minDate);\n        }\n      },\n      minYear: {\n        key: 'minYear',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('minYear'), {\n            field: component.errorLabel,\n            minYear: setting\n          });\n        },\n        check: function check(component, setting, value) {\n          var minYear = setting;\n          var year = /\\d{4}$/.exec(value);\n          year = year ? year[0] : null;\n\n          if (!+minYear || !+year) {\n            return true;\n          }\n\n          return +year >= +minYear;\n        }\n      },\n      maxYear: {\n        key: 'maxYear',\n        hasLabel: true,\n        message: function message(component, setting) {\n          return component.t(component.errorMessage('maxYear'), {\n            field: component.errorLabel,\n            maxYear: setting\n          });\n        },\n        check: function check(component, setting, value) {\n          var maxYear = setting;\n          var year = /\\d{4}$/.exec(value);\n          year = year ? year[0] : null;\n\n          if (!+maxYear || !+year) {\n            return true;\n          }\n\n          return +year <= +maxYear;\n        }\n      },\n      calendar: {\n        key: 'validate.calendar',\n        messageText: '',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage(this.validators.calendar.messageText), {\n            field: component.errorLabel,\n            maxDate: (0, _moment.default)(component.dataValue).format(component.format)\n          });\n        },\n        check: function check(component, setting, value, data, index) {\n          this.validators.calendar.messageText = '';\n          var widget = component.getWidget(index);\n\n          if (!widget) {\n            return true;\n          }\n\n          var settings = widget.settings,\n              enteredDate = widget.enteredDate;\n          var minDate = settings.minDate,\n              maxDate = settings.maxDate,\n              format = settings.format;\n          var momentFormat = [(0, _utils.convertFormatToMoment)(format)];\n\n          if (momentFormat[0].match(/M{3,}/g)) {\n            momentFormat.push(momentFormat[0].replace(/M{3,}/g, 'MM'));\n          }\n\n          if (!value && enteredDate) {\n            var _checkInvalidDate = (0, _calendarUtils.checkInvalidDate)(enteredDate, momentFormat, minDate, maxDate),\n                message = _checkInvalidDate.message,\n                result = _checkInvalidDate.result;\n\n            if (!result) {\n              this.validators.calendar.messageText = message;\n              return result;\n            }\n          }\n\n          if (value && enteredDate) {\n            if ((0, _moment.default)(value).format() !== (0, _moment.default)(enteredDate, momentFormat, true).format() && enteredDate.match(/_/gi)) {\n              this.validators.calendar.messageText = _calendarUtils.CALENDAR_ERROR_MESSAGES.INCOMPLETE;\n              return false;\n            } else {\n              widget.enteredDate = '';\n              return true;\n            }\n          }\n        }\n      },\n      time: {\n        key: 'validate.time',\n        messageText: 'Invalid time',\n        hasLabel: true,\n        message: function message(component) {\n          return component.t(component.errorMessage(this.validators.time.messageText), {\n            field: component.errorLabel\n          });\n        },\n        check: function check(component, setting, value) {\n          if (component.isEmpty(value)) return true;\n          return (0, _moment.default)(value, component.component.format).isValid();\n        }\n      }\n    };\n  }\n\n  _createClass(ValidationChecker, [{\n    key: \"checkValidator\",\n    value: function checkValidator(component, validator, setting, value, data, index, row, async) {\n      var _this2 = this;\n\n      var resultOrPromise = null; // Allow each component to override their own validators by implementing the validator.method\n\n      if (validator.method && typeof component[validator.method] === 'function') {\n        resultOrPromise = component[validator.method](setting, value, data, index, row, async);\n      } else {\n        resultOrPromise = validator.check.call(this, component, setting, value, data, index, row, async);\n      }\n\n      var processResult = function processResult(result) {\n        if (typeof result === 'string') {\n          return result;\n        }\n\n        if (!result && validator.message) {\n          return validator.message.call(_this2, component, setting, index, row);\n        }\n\n        return '';\n      };\n\n      if (async) {\n        return _nativePromiseOnly.default.resolve(resultOrPromise).then(processResult);\n      } else {\n        return processResult(resultOrPromise);\n      }\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(component, validatorName, value, data, index, row, async, conditionallyVisible, validationObj) {\n      // Skip validation for conditionally hidden components\n      if (!conditionallyVisible) {\n        return false;\n      }\n\n      var validator = this.validators[validatorName];\n\n      var setting = _lodash.default.get(validationObj || component.component, validator.key, null);\n\n      var resultOrPromise = this.checkValidator(component, validator, setting, value, data, index, row, async);\n\n      var processResult = function processResult(result) {\n        if (result) {\n          var _component$refs$input;\n\n          var resultData = {\n            message: (0, _utils.unescapeHTML)(_lodash.default.get(result, 'message', result)),\n            level: _lodash.default.get(result, 'level') === 'warning' ? 'warning' : 'error',\n            path: (0, _utils.getArrayFromComponentPath)(component.path || ''),\n            context: {\n              validator: validatorName,\n              hasLabel: validator.hasLabel,\n              setting: setting,\n              key: component.key,\n              label: component.label,\n              value: value,\n              index: index,\n              input: (_component$refs$input = component.refs.input) === null || _component$refs$input === void 0 ? void 0 : _component$refs$input[index]\n            }\n          };\n\n          if (validatorName === 'unique' && component.conflictId) {\n            resultData.conflictId = component.conflictId;\n          }\n\n          return resultData;\n        } else {\n          return false;\n        }\n      };\n\n      if (async) {\n        return _nativePromiseOnly.default.resolve(resultOrPromise).then(processResult);\n      } else {\n        return processResult(resultOrPromise);\n      }\n    }\n  }, {\n    key: \"checkComponent\",\n    value: function checkComponent(component, data, row) {\n      var _component$addons,\n          _this3 = this;\n\n      var includeWarnings = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      var async = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n      var isServerSidePersistent = typeof process !== 'undefined' && _lodash.default.get(process, 'release.name') === 'node' && !_lodash.default.defaultTo(component.component.persistent, true); // If we're server-side and it's not a persistent component, don't run validation at all\n\n      if (isServerSidePersistent || component.component.validate === false) {\n        return async ? _nativePromiseOnly.default.resolve([]) : [];\n      }\n\n      data = data || component.rootValue;\n      row = row || component.data;\n      var values = component.component.multiple && Array.isArray(component.validationValue) ? component.validationValue : [component.validationValue];\n      var conditionallyVisible = component.conditionallyVisible();\n      var addonsValidations = [];\n\n      if (component !== null && component !== void 0 && (_component$addons = component.addons) !== null && _component$addons !== void 0 && _component$addons.length) {\n        values.forEach(function (value) {\n          component.addons.forEach(function (addon) {\n            if (!addon.checkValidity(value)) {\n              addonsValidations.push.apply(addonsValidations, _toConsumableArray(addon.errors || []));\n            }\n          });\n        });\n      } // If this component has the new validation system enabled, use it instead.\n\n\n      var validations = _lodash.default.get(component, 'component.validations');\n\n      var nextGenResultsOrPromises = [];\n\n      if (validations && Array.isArray(validations) && validations.length) {\n        var validationsGroupedByMode = _lodash.default.chain(validations).groupBy(function (validation) {\n          return validation.mode;\n        }).value();\n\n        if (component.calculateCondition) {\n          includeWarnings = true;\n\n          var uiGroupedValidation = _lodash.default.chain(validationsGroupedByMode.ui).filter('active').groupBy(function (validation) {\n            return validation.group || null;\n          }).value();\n\n          var commonValidations = uiGroupedValidation.null || [];\n          delete uiGroupedValidation.null;\n          commonValidations.forEach(function (_ref3) {\n            var condition = _ref3.condition,\n                message = _ref3.message,\n                severity = _ref3.severity;\n\n            if (!component.calculateCondition(condition)) {\n              nextGenResultsOrPromises.push({\n                level: severity || 'error',\n                message: component.t(message),\n                componentInstance: component\n              });\n            }\n          });\n\n          _lodash.default.forEach(uiGroupedValidation, function (validationGroup) {\n            _lodash.default.forEach(validationGroup, function (_ref4) {\n              var condition = _ref4.condition,\n                  message = _ref4.message,\n                  severity = _ref4.severity;\n\n              if (!component.calculateCondition(condition)) {\n                nextGenResultsOrPromises.push({\n                  level: severity || 'error',\n                  message: component.t(message),\n                  componentInstance: component\n                });\n                return false;\n              }\n            });\n          });\n        } else {\n          nextGenResultsOrPromises = this.checkValidations(component, validations, data, row, values, async);\n        }\n\n        if (component.validators.includes('custom') && validationsGroupedByMode.js) {\n          _lodash.default.each(validationsGroupedByMode.js, function (validation) {\n            nextGenResultsOrPromises.push(_lodash.default.map(values, function (value, index) {\n              return _this3.validate(component, 'custom', value, data, index, row, async, conditionallyVisible, validation);\n            }));\n          });\n        }\n\n        if (component.validators.includes('json') && validationsGroupedByMode.json) {\n          _lodash.default.each(validationsGroupedByMode.json, function (validation) {\n            nextGenResultsOrPromises.push(_lodash.default.map(values, function (value, index) {\n              return _this3.validate(component, 'json', value, data, index, row, async, conditionallyVisible, validation);\n            }));\n          });\n        }\n      }\n\n      var validateCustom = _lodash.default.get(component, 'component.validate.custom');\n\n      var customErrorMessage = _lodash.default.get(component, 'component.validate.customMessage'); // Run primary validators\n\n\n      var resultsOrPromises = (0, _lodash.default)(component.validators).chain().map(function (validatorName) {\n        if (!_this3.validators.hasOwnProperty(validatorName)) {\n          return {\n            message: \"Validator for \\\"\".concat(validatorName, \"\\\" is not defined\"),\n            level: 'warning',\n            context: {\n              validator: validatorName,\n              key: component.key,\n              label: component.label\n            }\n          };\n        } // Handle the case when there is no values defined and it is required.\n\n\n        if (validatorName === 'required' && !values.length) {\n          return [_this3.validate(component, validatorName, null, data, 0, row, async, conditionallyVisible)];\n        }\n\n        return _lodash.default.map(values, function (value, index) {\n          return _this3.validate(component, validatorName, value, data, index, row, async, conditionallyVisible);\n        });\n      }).flatten().value(); // Run the \"unique\" pseudo-validator\n\n      component.component.validate = component.component.validate || {};\n      component.component.validate.unique = component.component.unique;\n      resultsOrPromises.push(this.validate(component, 'unique', component.validationValue, data, 0, data, async, conditionallyVisible)); // Run the \"multiple\" pseudo-validator\n\n      component.component.validate.multiple = component.component.multiple;\n      resultsOrPromises.push(this.validate(component, 'multiple', component.validationValue, data, 0, data, async, conditionallyVisible));\n      resultsOrPromises.push.apply(resultsOrPromises, addonsValidations);\n      resultsOrPromises.push.apply(resultsOrPromises, _toConsumableArray(nextGenResultsOrPromises)); // Define how results should be formatted\n\n      var formatResults = function formatResults(results) {\n        // Condense to a single flat array\n        results = (0, _lodash.default)(results).chain().flatten().compact().value();\n\n        if (customErrorMessage || validateCustom) {\n          _lodash.default.each(results, function (result) {\n            result.message = component.t(customErrorMessage || result.message, {\n              field: component.errorLabel,\n              data: data,\n              row: row,\n              error: result\n            });\n            result.context.hasLabel = false;\n          });\n        }\n\n        return includeWarnings ? results : _lodash.default.reject(results, function (result) {\n          return result.level === 'warning';\n        });\n      }; // Wait for results if using async mode, otherwise process and return immediately\n\n\n      if (async) {\n        return _nativePromiseOnly.default.all(resultsOrPromises).then(formatResults);\n      } else {\n        return formatResults(resultsOrPromises);\n      }\n    }\n    /**\n     * Use the new validations engine to evaluate any errors.\n     *\n     * @param component\n     * @param validations\n     * @param data\n     * @param row\n     * @param values\n     * @returns {any[]}\n     */\n\n  }, {\n    key: \"checkValidations\",\n    value: function checkValidations(component, validations, data, row, values, async) {\n      var _this4 = this;\n\n      // Get results.\n      var results = validations.map(function (validation) {\n        return _this4.checkRule(component, validation, data, row, values, async);\n      }); // Flatten array and filter out empty results.\n\n      var messages = results.reduce(function (prev, result) {\n        if (result) {\n          return [].concat(_toConsumableArray(prev), _toConsumableArray(result));\n        }\n\n        return prev;\n      }, []).filter(function (result) {\n        return result;\n      }); // Keep only the last error for each rule.\n\n      var rules = messages.reduce(function (prev, message) {\n        prev[message.context.validator] = message;\n        return prev;\n      }, {});\n      return Object.values(rules);\n    }\n  }, {\n    key: \"checkRule\",\n    value: function checkRule(component, validation, data, row, values, async) {\n      var Rule = _Rules.default.getRule(validation.rule);\n\n      var results = [];\n\n      if (Rule) {\n        var rule = new Rule(component, validation.settings, this.config);\n        values.map(function (value, index) {\n          var result = rule.check(value, data, row, async);\n\n          if (result !== true) {\n            results.push({\n              level: validation.level || 'error',\n              message: component.t(validation.message || rule.defaultMessage, {\n                settings: validation.settings,\n                field: component.errorLabel,\n                data: data,\n                row: row,\n                error: result\n              }),\n              context: {\n                key: component.key,\n                index: index,\n                label: component.label,\n                validator: validation.rule\n              }\n            });\n          }\n        });\n      } // If there are no results, return false so it is removed by filter.\n\n\n      return results.length === 0 ? false : results;\n    }\n  }, {\n    key: \"check\",\n    get: function get() {\n      return this.checkComponent;\n    }\n  }, {\n    key: \"get\",\n    value: function get() {\n      _lodash.default.get.call(this, arguments);\n    }\n  }, {\n    key: \"each\",\n    value: function each() {\n      _lodash.default.each.call(this, arguments);\n    }\n  }, {\n    key: \"has\",\n    value: function has() {\n      _lodash.default.has.call(this, arguments);\n    }\n  }]);\n\n  return ValidationChecker;\n}();\n\nexports.ValidationChecker = ValidationChecker;\nValidationChecker.config = {\n  db: null,\n  token: null,\n  form: null,\n  submission: null\n};\nvar instance = new ValidationChecker();\nexports.default = instance;"],"mappings":"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"},"metadata":{},"sourceType":"script"}