{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getFormioUploadAdapterPlugin = void 0;\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.promise.js\");\nrequire(\"core-js/modules/es.promise.finally.js\");\nrequire(\"core-js/modules/es.array.concat.js\");\nvar _utils = require(\"../../utils/utils\");\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\n/**\n * UploadAdapter for CKEditor https://ckeditor.com/docs/ckeditor5/latest/framework/guides/deep-dive/upload-adapter.html\n */\nvar FormioUploadAdapter = /*#__PURE__*/function () {\n  function FormioUploadAdapter(loader, fileService, component) {\n    _classCallCheck(this, FormioUploadAdapter);\n    this.loader = loader;\n    this.fileService = fileService;\n    this.component = component;\n  }\n  _createClass(FormioUploadAdapter, [{\n    key: \"upload\",\n    value: function upload() {\n      var _this = this;\n      return this.loader.file.then(function (file) {\n        return new _nativePromiseOnly.default(function (resolve, reject) {\n          var _this$fileService;\n          var _this$component$compo = _this.component.component,\n            uploadStorage = _this$component$compo.uploadStorage,\n            uploadUrl = _this$component$compo.uploadUrl,\n            uploadOptions = _this$component$compo.uploadOptions,\n            uploadDir = _this$component$compo.uploadDir,\n            fileKey = _this$component$compo.fileKey;\n          var uploadParams = [uploadStorage, file, (0, _utils.uniqueName)(file.name), uploadDir || '',\n          //should pass empty string if undefined\n          function (evt) {\n            return _this.onUploadProgress(evt);\n          }, uploadUrl, uploadOptions, fileKey, null, null];\n          var uploadPromise = (_this$fileService = _this.fileService).uploadFile.apply(_this$fileService, uploadParams.concat([function () {\n            return _this.component.emit('fileUploadingStart', uploadPromise);\n          }])).then(function (result) {\n            return _this.fileService.downloadFile(result);\n          }).then(function (result) {\n            return resolve({\n              default: result.url\n            });\n          }).catch(function (err) {\n            console.warn('An Error occured while uploading file', err);\n            reject(err);\n          }).finally(function () {\n            _this.component.emit('fileUploadingEnd', uploadPromise);\n          });\n        });\n      });\n    }\n  }, {\n    key: \"abort\",\n    value: function abort() {}\n  }, {\n    key: \"onUploadProgress\",\n    value: function onUploadProgress(evt) {\n      if (evt.lengthComputable) {\n        this.loader.uploadTotal = evt.total;\n        this.loader.uploaded = evt.loaded;\n      }\n    }\n  }]);\n  return FormioUploadAdapter;\n}();\nvar getFormioUploadAdapterPlugin = function getFormioUploadAdapterPlugin(fileService, component) {\n  return function (editor) {\n    editor.plugins.get('FileRepository').createUploadAdapter = function (loader) {\n      return new FormioUploadAdapter(loader, fileService, component);\n    };\n  };\n};\nexports.getFormioUploadAdapterPlugin = getFormioUploadAdapterPlugin;","map":{"version":3,"names":["Object","defineProperty","exports","value","getFormioUploadAdapterPlugin","require","_utils","_nativePromiseOnly","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","prototype","FormioUploadAdapter","loader","fileService","component","upload","_this","file","then","resolve","reject","_this$fileService","_this$component$compo","uploadStorage","uploadUrl","uploadOptions","uploadDir","fileKey","uploadParams","uniqueName","name","evt","onUploadProgress","uploadPromise","uploadFile","apply","concat","emit","result","downloadFile","url","catch","err","console","warn","finally","abort","lengthComputable","uploadTotal","total","uploaded","loaded","editor","plugins","get","createUploadAdapter"],"sources":["D:/task/node_modules/formiojs/providers/storage/uploadAdapter.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getFormioUploadAdapterPlugin = void 0;\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nrequire(\"core-js/modules/es.promise.finally.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nvar _utils = require(\"../../utils/utils\");\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n/**\n * UploadAdapter for CKEditor https://ckeditor.com/docs/ckeditor5/latest/framework/guides/deep-dive/upload-adapter.html\n */\nvar FormioUploadAdapter = /*#__PURE__*/function () {\n  function FormioUploadAdapter(loader, fileService, component) {\n    _classCallCheck(this, FormioUploadAdapter);\n\n    this.loader = loader;\n    this.fileService = fileService;\n    this.component = component;\n  }\n\n  _createClass(FormioUploadAdapter, [{\n    key: \"upload\",\n    value: function upload() {\n      var _this = this;\n\n      return this.loader.file.then(function (file) {\n        return new _nativePromiseOnly.default(function (resolve, reject) {\n          var _this$fileService;\n\n          var _this$component$compo = _this.component.component,\n              uploadStorage = _this$component$compo.uploadStorage,\n              uploadUrl = _this$component$compo.uploadUrl,\n              uploadOptions = _this$component$compo.uploadOptions,\n              uploadDir = _this$component$compo.uploadDir,\n              fileKey = _this$component$compo.fileKey;\n          var uploadParams = [uploadStorage, file, (0, _utils.uniqueName)(file.name), uploadDir || '', //should pass empty string if undefined\n          function (evt) {\n            return _this.onUploadProgress(evt);\n          }, uploadUrl, uploadOptions, fileKey, null, null];\n\n          var uploadPromise = (_this$fileService = _this.fileService).uploadFile.apply(_this$fileService, uploadParams.concat([function () {\n            return _this.component.emit('fileUploadingStart', uploadPromise);\n          }])).then(function (result) {\n            return _this.fileService.downloadFile(result);\n          }).then(function (result) {\n            return resolve({\n              default: result.url\n            });\n          }).catch(function (err) {\n            console.warn('An Error occured while uploading file', err);\n            reject(err);\n          }).finally(function () {\n            _this.component.emit('fileUploadingEnd', uploadPromise);\n          });\n        });\n      });\n    }\n  }, {\n    key: \"abort\",\n    value: function abort() {}\n  }, {\n    key: \"onUploadProgress\",\n    value: function onUploadProgress(evt) {\n      if (evt.lengthComputable) {\n        this.loader.uploadTotal = evt.total;\n        this.loader.uploaded = evt.loaded;\n      }\n    }\n  }]);\n\n  return FormioUploadAdapter;\n}();\n\nvar getFormioUploadAdapterPlugin = function getFormioUploadAdapterPlugin(fileService, component) {\n  return function (editor) {\n    editor.plugins.get('FileRepository').createUploadAdapter = function (loader) {\n      return new FormioUploadAdapter(loader, fileService, component);\n    };\n  };\n};\n\nexports.getFormioUploadAdapterPlugin = getFormioUploadAdapterPlugin;"],"mappings":"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"},"metadata":{},"sourceType":"script"}